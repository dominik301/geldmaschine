const kreditaufnehmen=document.getElementById("kreditaufnehmenbutton"),kredittilgen=document.getElementById("kredittilgenbutton"),kredit=document.getElementById("credit-leftp-money");function cancelkredit(){$("#board").show(),$("#control").show(),$("#credit").hide(),$("#icon-bar a.active").removeClass("active"),$("#logicon").addClass("active")}kreditaufnehmen.onclick=function(e){if(e.preventDefault(),isNaN(document.getElementById("credit-leftp-money").value))return document.getElementById("credit-leftp-money").value="Bitte eine Zahl eingeben.",document.getElementById("credit-leftp-money").style.color="red",!1;var t=kredit.value;if(!confirm(document.getElementById("player"+playerId+"name").innerHTML+", möchtest Du wirklich einen Kredit aufnehmen?"))return!1;socket.emit("kreditaufnehmen",t),kredit.value="0"},kredittilgen.onclick=function(e){return e.preventDefault(),isNaN(document.getElementById("credit-leftp-money").value)?(document.getElementById("credit-leftp-money").value="Bitte eine Zahl eingeben.",document.getElementById("credit-leftp-money").style.color="red",!1):!!confirm(document.getElementById("player"+playerId+"name").innerHTML+", möchtest Du wirklich deinen Kredit tilgen?")&&(socket.emit("kredittilgen",kredit.value),void(kredit.value="0"))};const next=document.getElementById("nextbutton"),resign=document.getElementById("resignbutton"),creditB=document.getElementById("creditbutton");var round=0;function updateChart(){xValues.push(round),geldMengen.push(meineBank.geldMenge),bankZinsen.push(meineBank.zinsenLotto),round++,myChart.update()}function buy(){socket.emit("buy")}function doResign(){socket.emit("resign")}next.onclick=function(e){e.preventDefault(),socket.emit("next"),"Spielzug beenden"==next.value&&($("#nextbutton").hide(),allow2houses=!1)},socket.on("updateChart",updateChart),resign.onclick=function(e){e.preventDefault(),socket.emit("sozialhilfe")},creditB.onclick=function(e){e.preventDefault(),showCreditMenu()};const buyhouse=document.getElementById("buyhousebutton"),mortgage=document.getElementById("mortgagebutton"),sellhouse=document.getElementById("sellhousebutton");var currentInitiator,currentRecipient,tradeObj;buyhouse.onclick=function(e){e.preventDefault(),socket.emit("buyhouse",getCheckedProperty())},mortgage.onclick=function(e){e.preventDefault(),socket.emit("mortgage",getCheckedProperty())},sellhouse.onclick=function(e){e.preventDefault(),socket.emit("sellhouse",getCheckedProperty())},socket.on("tradeObj",(function(e){tradeObj=e}));var square,player,meineBank,highestbidder,highestbid,allow2houses=!1;function readTrade(){for(var e,t,n,o=currentInitiator,d=currentRecipient,r=new Array(12),a=[],i=0;i<12;i++)document.getElementById("tradeleftcheckbox"+i)&&document.getElementById("tradeleftcheckbox"+i).checked?r[i]=1:document.getElementById("traderightcheckbox"+i)&&document.getElementById("traderightcheckbox"+i).checked?r[i]=-1:r[i]=0;document.getElementById("tradeleftcheckboxM")&&document.getElementById("tradeleftcheckboxM").checked?a[0]=1:document.getElementById("traderightcheckboxM")&&document.getElementById("traderightcheckboxM").checked?a[0]=-1:a[0]=0,document.getElementById("tradeleftcheckboxA")&&document.getElementById("tradeleftcheckboxA").checked?a[1]=1:document.getElementById("traderightcheckboxA")&&document.getElementById("traderightcheckboxA").checked?a[1]=-1:a[1]=0,document.getElementById("tradeleftcheckboxY")&&document.getElementById("tradeleftcheckboxY").checked?a[2]=1:document.getElementById("traderightcheckboxY")&&document.getElementById("traderightcheckboxY").checked?a[2]=-1:a[2]=0,0==a[2]&&0==a[1]&&0==a[0]&&(a=[]),e=parseInt(document.getElementById("trade-leftp-money").value,10)||0,e-=parseInt(document.getElementById("trade-rightp-money").value,10)||0,t=parseInt(document.getElementById("trade-leftp-anleihen").value,10)||0,t-=parseInt(document.getElementById("trade-rightp-anleihen").value,10)||0,n=parseInt(document.getElementById("trade-leftp-derivate").value,10)||0,n-=parseInt(document.getElementById("trade-rightp-derivate").value,10)||0,socket.emit("newTrade",o,d,e,r,t,n,a)}function writeTrade(e){resetTrade(e.initiator,e.recipient,!1);for(var t=0;t<12;t++)document.getElementById("tradeleftcheckbox"+t)&&(document.getElementById("tradeleftcheckbox"+t).checked=!1,1===e.property[t]&&(document.getElementById("tradeleftcheckbox"+t).checked=!0)),document.getElementById("traderightcheckbox"+t)&&(document.getElementById("traderightcheckbox"+t).checked=!1,-1===e.property[t]&&(document.getElementById("traderightcheckbox"+t).checked=!0));document.getElementById("tradeleftcheckboxM")&&(document.getElementById("tradeleftcheckboxM").checked=!1,e.assets[0]>0&&(document.getElementById("tradeleftcheckboxM").checked=!0)),document.getElementById("traderightcheckboxM")&&(document.getElementById("traderightcheckboxM").checked=!1,e.assets[0]<0&&(document.getElementById("traderightcheckboxM").checked=!0)),document.getElementById("tradeleftcheckboxA")&&(document.getElementById("tradeleftcheckboxA").checked=!1,e.assets[1]>0&&(document.getElementById("tradeleftcheckboxA").checked=!0)),document.getElementById("traderightcheckboxA")&&(document.getElementById("traderightcheckboxA").checked=!1,e.assets[1]<0&&(document.getElementById("traderightcheckboxA").checked=!0)),document.getElementById("tradeleftcheckboxY")&&(document.getElementById("tradeleftcheckboxY").checked=!1,e.assets[2]>0&&(document.getElementById("tradeleftcheckboxY").checked=!0)),document.getElementById("traderightcheckboxY")&&(document.getElementById("traderightcheckboxY").checked=!1,e.assets[2]<0&&(document.getElementById("traderightcheckboxY").checked=!0)),e.money>0?document.getElementById("trade-leftp-money").value=e.money+"":document.getElementById("trade-rightp-money").value=-e.money+"",e.anleihen>0?document.getElementById("trade-leftp-anleihen").value=e.anleihen+"":document.getElementById("trade-rightp-anleihen").value=-e.anleihen+"",e.derivate>0?document.getElementById("trade-leftp-derivate").value=e.derivate+"":document.getElementById("trade-rightp-derivate").value=-e.derivate+""}function proposeTrade(){return isNaN(document.getElementById("trade-leftp-money").value)?(document.getElementById("trade-leftp-money").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-leftp-money").style.color="red",!1):isNaN(document.getElementById("trade-rightp-money").value)?(document.getElementById("trade-rightp-money").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-rightp-money").style.color="red",!1):isNaN(document.getElementById("trade-leftp-anleihen").value)?(document.getElementById("trade-leftp-anleihen").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-leftp-anleihen").style.color="red",!1):isNaN(document.getElementById("trade-rightp-anleihen").value)?(document.getElementById("trade-rightp-anleihen").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-rightp-anleihen").style.color="red",!1):isNaN(document.getElementById("trade-leftp-derivate").value)?(document.getElementById("trade-leftp-derivate").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-leftp-derivate").style.color="red",!1):isNaN(document.getElementById("trade-rightp-derivate").value)?(document.getElementById("trade-rightp-derivate").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-rightp-derivate").style.color="red",!1):(readTrade(),void setTimeout((()=>{finishProposeTrade()}),100))}function tradeAltered(){$("#proposetradebutton").show(),$("#accepttradebutton").hide()}function finishProposeTrade(){var e=tradeObj.money,t=tradeObj.initiator,n=tradeObj.recipient,o=[],d=tradeObj.anleihen,r=tradeObj.derivate,a=tradeObj.assets,i=[];if(0==n.index&&(n.anleihen=n.anleihen,n.derivate=n.derivate),e>0&&e>t.money)return document.getElementById("trade-leftp-money").value=t.name+" hat keine "+e+".",document.getElementById("trade-leftp-money").style.color="red",!1;if("Bank"!=n.name&&e<0&&-e>n.money)return document.getElementById("trade-rightp-money").value=n.name+" hat keine "+-e+".",document.getElementById("trade-rightp-money").style.color="red",!1;if(d>0&&d>t.anleihen)return document.getElementById("trade-leftp-anleihen").value=t.name+" hat keine Anleihen im Wert von "+d+".",document.getElementById("trade-leftp-anleihen").style.color="red",!1;if(d<0&&-d>n.anleihen)return document.getElementById("trade-rightp-anleihen").value=n.name+" hat keine Anleihen im Wert von "+-d+".",document.getElementById("trade-rightp-anleihen").style.color="red",!1;if(r>0&&r>t.derivate)return document.getElementById("trade-leftp-derivate").value=t.name+" hat keine Derivate im Wert von "+r+".",document.getElementById("trade-leftp-derivate").style.color="red",!1;if(r<0&&-r>n.derivate)return document.getElementById("trade-rightp-derivate").value=n.name+" hat keine Derivate im Wert von "+-r+".",document.getElementById("trade-rightp-derivate").style.color="red",!1;for(var c=0;c<12;c++)o[c]=-tradeObj.property[c];for(c=0;c<a.length;c++)i[c]=-a[c];if(!confirm(t.name+", bist du sicher, dass du dieses Angebot an "+n.name+" machen willst?"))return!1;socket.emit("newTrade",n,t,-e,o,-d,-r,i),socket.emit("sendOffer"),cancelTrade()}function cancelTrade(){$("#board").show(),$("#control").show(),$("#trade").hide(),$("#credit").hide(),$("#icon-bar a.active").removeClass("active"),$("#logicon").addClass("active")}function acceptTrade(){if(isNaN(document.getElementById("trade-leftp-money").value))return document.getElementById("trade-leftp-money").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-leftp-money").style.color="red",!1;if(isNaN(document.getElementById("trade-rightp-money").value))return document.getElementById("trade-rightp-money").value="Der Wert muss eine Zahl sein.",document.getElementById("trade-rightp-money").style.color="red",!1;readTrade(),setTimeout((()=>{finishAcceptTrade(true)}),100)}function finishAcceptTrade(e){var t,n,o;t=tradeObj.money,anleihen=tradeObj.anleihen,derivate=tradeObj.derivate,n=tradeObj.initiator,o=tradeObj.recipient,assets=tradeObj.assets;for(var d=0;d<12;d++)isAPropertySelected|=tradeObj.property[d];if(e&&!confirm(n.name+", bist du sicher, dass du diesen Tausch mit "+o.name+" machen willst?"))return!1;for(d=0;d<12;d++)1===tradeObj.property[d]?(socket.emit("changeOwner",d,o.index),socket.emit("addAlert",o.name+" hat "+square[d].name+" von "+n.name+" erhalten.")):-1===tradeObj.property[d]&&(socket.emit("changeOwner",d,n.index),socket.emit("addAlert",n.name+" hat "+square[d].name+" von "+o.name+" erhalten."));3==tradeObj.assets.length&&socket.emit("transferAssets",n.index,o.index,assets),t>0?(socket.emit("pay",n,o,t),socket.emit("addAlert",o.name+" bekommt "+t+" von "+n.name+".")):t<0&&(socket.emit("pay",o,n,-t),socket.emit("addAlert",n.name+" bekommt "+-t+" von "+o.name+".")),anleihen>0?(socket.emit("buyAnleihen",n.index,o.index,anleihen),socket.emit("addAlert",o.name+" bekommt Anleihen im Wert von "+anleihen+" von "+n.name+".")):anleihen<0&&(socket.emit("buyAnleihen",o.index,n.index,-anleihen),socket.emit("addAlert",n.name+" bekommt Anleihen im Wert von "+-anleihen+" von "+o.name+".")),derivate>0?(socket.emit("buyDerivate",n.index,o.index,derivate),socket.emit("addAlert",o.name+" bekommt Derivate im Wert von "+derivate+" von "+n.name+".")):derivate<0&&(socket.emit("buyDerivate",o.index,n.index,-derivate),socket.emit("addAlert",n.name+" bekommt Derivate im Wert von "+-derivate+" von "+o.name+".")),socket.emit("updateOwned"),socket.emit("updateMoney"),$("#board").show(),$("#control").show(),$("#trade").hide(),$("#credit").hide()}function resetTrade(e,t,n){var o,d,r,a,i,c,l;0==t.index?document.getElementById("description-derivate").innerHTML="Derivate (Kurs: "+meineBank.derivateKurs+"):":document.getElementById("description-derivate").innerHTML="Derivate";var u=function(e){var t=this.firstChild.firstChild;t!==e.srcElement&&(t.checked=!t.checked),$("#proposetradebutton").show(),$("#canceltradebutton").show(),$("#accepttradebutton").hide(),$("#rejecttradebutton").hide()},m=document.getElementById("trade-leftp-property"),s=document.getElementById("trade-rightp-property");for(currentInitiator=e,currentRecipient=t;m.lastChild;)m.removeChild(m.lastChild);for(;s.lastChild;)s.removeChild(s.lastChild);for(var p=document.createElement("table"),h=document.createElement("table"),y=0;y<12;y++)if((o=square[y]).owner===e.index)(d=p.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="tradeleftcheckbox"+y,a.title="Check this box to include "+o.name+" in the trade.",(r=d.appendChild(document.createElement("td"))).className="propertycellcolor",r.style.backgroundColor=o.color,1==o.groupNumber||2==o.groupNumber?r.style.borderColor="grey":r.style.borderColor=o.color,r.propertyIndex=y,r.onmouseover=function(){showdeed(this.propertyIndex)},r.onmouseout=hidedeed,(r=d.appendChild(document.createElement("td"))).className="propertycellname",o.mortgage&&(r.title="Mortgaged",r.style.color="grey"),r.textContent=o.name;else if(o.owner===t.index){if(0==t.index)continue;(d=h.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="traderightcheckbox"+y,a.title="Check this box to include "+o.name+" in the trade.",(r=d.appendChild(document.createElement("td"))).className="propertycellcolor",r.style.backgroundColor=o.color,1==o.groupNumber||2==o.groupNumber?r.style.borderColor="grey":r.style.borderColor=o.color,r.propertyIndex=y,r.onmouseover=function(){showdeed(this.propertyIndex)},r.onmouseout=hidedeed,(r=d.appendChild(document.createElement("td"))).className="propertycellname",o.mortgage&&(r.title="Mortgaged",r.style.color="grey"),r.textContent=o.name}p.lastChild?m.appendChild(p):m.textContent=e.name+" hat keine Grundstücke zum Handeln.",h.lastChild?s.appendChild(h):s.textContent=t.name+" hat keine Grundstücke zum Handeln.";for(var g=document.getElementById("trade-leftp-assets"),b=document.getElementById("trade-rightp-assets");g.lastChild;)g.removeChild(g.lastChild);for(;b.lastChild;)b.removeChild(b.lastChild);p=document.createElement("table"),h=document.createElement("table");if(e.yacht>0&&((d=p.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="tradeleftcheckboxY",a.title="Check this box to include Yacht in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-sailboat"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Yacht"),t.yacht>0&&((d=h.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="traderightcheckboxY",a.title="Check this box to include Yacht in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-sailboat"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Yacht"),e.auto>0&&((d=p.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="tradeleftcheckboxA",a.title="Check this box to include Auto in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-car"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Auto"),t.auto>0&&((d=h.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="traderightcheckboxA",a.title="Check this box to include Auto in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-car"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Auto"),e.motorrad>0&&((d=p.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="tradeleftcheckboxM",a.title="Check this box to include Motorrad in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-motorcycle"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Motorrad"),t.motorrad>0&&((d=h.appendChild(document.createElement("tr"))).onclick=u,(r=d.appendChild(document.createElement("td"))).className="propertycellcheckbox",(a=r.appendChild(document.createElement("input"))).type="checkbox",a.id="traderightcheckboxM",a.title="Check this box to include Motorrad in the trade.",(r=d.appendChild(document.createElement("td"))).className="assetcellcolor",r.innerHTML='<i class="fa-solid fa-motorcycle"></i>',(r=d.appendChild(document.createElement("td"))).className="propertycellname",r.textContent="Motorrad"),p.lastChild?g.appendChild(p):g.textContent=e.name+" hat keine Wertgegenstände zum Handeln.",h.lastChild?b.appendChild(h):b.textContent=t.name+" hat keine Wertgegenstände zum Handeln.",document.getElementById("trade-leftp-name").textContent=e.name,l=document.getElementById("trade-rightp-name"),n&&pcount>2){for(;l.lastChild;)l.removeChild(l.lastChild);i=l.appendChild(document.createElement("select"));for(y=1;y<=pcount;y++)y!==e.index&&((c=i.appendChild(document.createElement("option"))).value=y+"",c.style.color=player[y].color,c.textContent=player[y].name,y===t.index&&(c.selected="selected"));(c=i.appendChild(document.createElement("option"))).value="0",c.style.color=meineBank.color,c.textContent=meineBank.name,0===t.index&&(c.selected="selected"),i.onchange=function(){resetTrade(currentInitiator,player[parseInt(this.value,10)],!0)},i.title="Wähle einen Mitspieler zum Handeln aus."}else l.textContent=t.name;document.getElementById("trade-leftp-money").value="0",document.getElementById("trade-rightp-money").value="0",document.getElementById("trade-leftp-anleihen").value="0",document.getElementById("trade-rightp-anleihen").value="0",document.getElementById("trade-leftp-derivate").value="0",document.getElementById("trade-rightp-derivate").value="0"}function addAlert(e){$alert=$("#alert"),$(document.createElement("div")).text(e).appendTo($alert),$alert.stop().animate({scrollTop:$alert.prop("scrollHeight")},1e3)}function showEliminatePlayer(e,t){document.getElementById("popuptext").innerHTML=e,document.getElementById("popup").style.width="300px",document.getElementById("popup").style.top="0px",document.getElementById("popup").style.left="0px",option=t,option=option?option.toLowerCase():"","function"!=typeof t&&(t=null),$("#popuptext").append("<div><input type='button' value='OK' id='popupclose' /></div>"),$("#popupclose").focus(),$("#popupclose").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400)})).on("click",eliminatePlayer),$("#popupbackground").fadeIn(400,(function(){$("#popupwrap").show()}))}function eliminatePlayer(){socket.emit("eliminate")}function updateMoney(e,t,n,o,d){meineBank=n;var r=(player=e)[t];pcount=d,document.getElementById("pname").innerHTML=r.name,document.getElementById("pmoney").innerHTML="$"+r.money,$(".money-bar-row").hide();for(var a=1;a<=pcount;a++)p_i=player[a],$("#moneybarrow"+a).show(),document.getElementById("p"+a+"moneybar").style.border="2px solid "+p_i.color,document.getElementById("p"+a+"money").innerHTML=p_i.money>0?p_i.money:0,document.getElementById("p"+a+"moneyname").innerHTML=p_i.name,document.getElementById("p"+a+"credit").innerHTML=-p_i.sumKredit,document.getElementById("p"+a+"dispocredit").innerHTML=p_i.money>0?0:p_i.money,document.getElementById("p"+a+"avcredit").innerHTML=p_i.verfuegbareHypothek,document.getElementById("p"+a+"anleihen").innerHTML=p_i.anleihen,document.getElementById("p"+a+"derivate").innerHTML=p_i.derivate;$("#moneybarrow7").show(),document.getElementById("p7money").innerHTML=meineBank.geldMenge,document.getElementById("p7credit").innerHTML=meineBank.zinsenLotto,document.getElementById("p7anleihen").innerHTML=meineBank.anleihen,document.getElementById("p7derivate").innerHTML=meineBank.derivate,$("#moneybarrow8").show(),document.getElementById("p8money").innerHTML=o.staatsSchuld,document.getElementById("p8credit").innerHTML=o.steuer,""===document.getElementById("landed").innerHTML&&$("#landed").hide(),document.getElementById("quickstats").style.borderColor=r.color,t==playerId&&(r.money<0?($("#resignbutton").hide(),$("#creditbutton").show(),$("#nextbutton").show()):($("#resignbutton").hide(),$("#creditbutton").hide(),$("#nextbutton").show()))}function playDiceSound(e){new Audio("client/short-dice-roll.wav").play(),setTimeout((()=>{updateDice(e)}),500)}function updateDice(e){if($("#die0").show(),document.images){var t=document.getElementById("die0");t.classList.remove("die-no-img"),t.title="Die ("+e+" spots)";let n='<i class="fa-solid fa-dice-'+{1:"one",2:"two",3:"three",4:"four",5:"five",6:"six"}[e]+'"></i>';t.innerHTML=n}else document.getElementById("die0").textContent=e,document.getElementById("die0").title="Die"}function updateOwned(e,t){var n=getCheckedProperty(),o=e[playerId];$("#option").show(),$("#owned").show();for(var d,r,a="",i=-1,c="",l="",u=0;u<12;u++)if(d=t[u],r=square[u],d.groupNumber&&0===d.owner)$("#cell"+u+"owner").hide(),$("#cell"+u+"house").hide(),$("#cell"+u+"house2").hide();else if(d.groupNumber&&d.owner>0){var m=document.getElementById("cell"+u+"owner");if(m.style.display="block",m.style.backgroundColor=e[d.owner].color,m.title=e[d.owner].name,d.owner!=r.owner&&m.animate([{opacity:0},{opacity:1}],{duration:1e3}),d.house){var s=document.getElementById("cell"+u+"house");if(s.style.display="block",0==r.house&&s.animate([{opacity:0},{opacity:1}],{duration:1e3}),2==d.house){var p=document.getElementById("cell"+u+"house2");p.style.display="block",0==r.house&&p.animate([{opacity:0},{opacity:1}],{duration:1e3})}}else $("#cell"+u+"house").hide(),$("#cell"+u+"house2").hide()}for(u=0;u<12;u++)if((d=t[u]).owner==playerId){if(c="",d.mortgage&&(c="title='Hypothek aufgenommen' style='color: grey;'"),l="",d.house>=1&&d.house<=2)for(var h=1;h<=d.house;h++)l+="<i class=\"fa-solid fa-house\" title='Haus' class='house' ></i>";""===a&&(a+="<table>",i=u),a+="<tr class='property-cell-row'><td class='propertycellcheckbox'><input type='checkbox' id='propertycheckbox"+u+"' /></td><td class='propertycellcolor' style='background: "+d.color+";",a+="' onmouseover='showdeed("+u+");' onmouseout='hidedeed();'></td><td class='propertycellname' "+c+">"+d.name+l+"</td></tr>"}square=t,""===a?(a=o.name+", du besitzt keine Grundstücke.",$("#option").hide()):a+="</table>",document.getElementById("owned").innerHTML=a,n>-1&&document.getElementById("propertycheckbox"+n)?document.getElementById("propertycheckbox"+n).checked=!0:i>-1&&(document.getElementById("propertycheckbox"+i).checked=!0),$(".property-cell-row").on("click",(function(){var e=this;$(this).find(".propertycellcheckbox > input").prop("checked",(function(e,t){return!t})),$(".propertycellcheckbox > input").prop("checked",(function(t,n){if(!$.contains(e,this))return!1})),socket.emit("updateOption")}))}function updateOption(e){var t=getCheckedProperty(),n=e[t];if($("#option").show(),t<0||t>=12)return $("#buyhousebutton").hide(),$("#sellhousebutton").hide(),void $("#mortgagebutton").hide();$("#buildings").hide(),buyhousebutton=document.getElementById("buyhousebutton"),sellhousebutton=document.getElementById("sellhousebutton"),$("#mortgagebutton").show(),document.getElementById("mortgagebutton").disabled=!1,n.mortgage?(document.getElementById("mortgagebutton").value="Hypothek zurückzahlen",document.getElementById("mortgagebutton").title="Hypothek auf "+n.name+" für "+n.price+" zurückzahlen.",$("#buyhousebutton").hide(),$("#sellhousebutton").hide(),allGroupUnmortgaged=!1):(document.getElementById("mortgagebutton").value="Hypothek ($"+n.price+")",document.getElementById("mortgagebutton").title="Hypothek auf "+n.name+" für "+n.price+" aufnehmen."),$("#buyhousebutton").show(),$("#sellhousebutton").show(),buyhousebutton.disabled=!1,sellhousebutton.disabled=!1,0==n.house&&($("#sellhousebutton").hide(),buyhousebutton.value="Haus kaufen",buyhousebutton.title="Kaufe ein Haus für "+n.houseprice),n.house>=1&&(allow2houses&&2!=n.house?(buyhousebutton.value="Haus kaufen",buyhousebutton.title="Kaufe ein Haus für "+n.houseprice):$("#buyhousebutton").hide(),sellhousebutton.value="Haus verkaufen",sellhousebutton.title="Verkaufe eine Haus für "+n.houseprice,$("#mortgagebutton").show(),document.getElementById("mortgagebutton").disabled=!1,n.mortgage?(document.getElementById("mortgagebutton").value="Hypothek zurückzahlen",document.getElementById("mortgagebutton").title="Hypothek auf "+n.name+" für "+n.price+" zurückzahlen.",$("#buyhousebutton").hide(),$("#sellhousebutton").hide(),allGroupUnmortgaged=!1):(document.getElementById("mortgagebutton").value="Hypothek ($"+n.price+")",document.getElementById("mortgagebutton").title="Hypothek auf "+n.name+" für "+n.price+" aufnehmen."))}function showdeed2(e){$("#deed").show(),$("#deed-normal").hide(),$("#deed-mortgaged").hide(),$("#deed-special").hide(),e.mortgage?($("#deed-mortgaged").show(),document.getElementById("deed-mortgaged-name").textContent=e.name,document.getElementById("deed-mortgaged-mortgage").textContent=e.price/2):($("#deed-normal").show(),document.getElementById("deed-header").style.backgroundColor=e.color,document.getElementById("deed-name").textContent=e.name,document.getElementById("deed-rent").textContent=e.rent,document.getElementById("deed-houseprice").textContent=e.houseprice)}function displayStats(e){document.getElementById("statstext").innerHTML=e,$("#statsbackground").fadeIn(400,(function(){$("#statswrap").show()}))}function showGraph(){$("#statsbackground").fadeIn(400,(function(){$("#graphwrap").show()}))}function changeButton(e,t,n){document.getElementById(e).value=t,document.getElementById(e).title=n}function focusButton(e){document.getElementById(e).focus()}function roll(){$("#option").hide(),$("#buy").show(),$("#manage").hide(),$("#audio").hide(),document.getElementById("nextbutton").focus()}function setHTML(e,t){document.getElementById(e).innerHTML=t}function show(e){$(e).show()}function hide(e){$(e).hide()}function getCheckedProperty(){for(var e=0;e<12;e++)if(document.getElementById("propertycheckbox"+e)&&document.getElementById("propertycheckbox"+e).checked)return e;return-1}function openImmobilien(){$("#manage").show(),$("#buy").hide(),$("#audio").hide()}function openLog(){$("#buy").show(),$("#manage").hide(),$("#audio").hide(),cancelkredit(),cancelTrade(),$("#alert").scrollTop($("#alert").prop("scrollHeight"))}function openAudioMenu(){$("#audio").show(),$("#buy").hide(),$("#manage").hide()}function changeZinssatz(){socket.emit("zinssatz",parseInt(document.getElementById("zinssatzInput").value))}function setupSquares(e){var t=document.body.appendChild(document.createElement("div"));t.id="enlarge-wrap";for(var n,o,d,r,a="",i=0;i<12;i++)a+="<div id='enlarge"+i+"' class='enlarge'>",a+="<div id='enlarge"+i+"color' class='enlarge-color'></div><br /><div id='enlarge"+i+"name' class='enlarge-name'></div>",a+="<br /><div id='enlarge"+i+"price' class='enlarge-price'></div>",a+="<br /><div id='enlarge"+i+"token' class='enlarge-token'></div></div>";t.innerHTML=a;for(i=0;i<12;i++)s=e[i],(n=document.getElementById("cell"+i).appendChild(document.createElement("div"))).id="cell"+i+"anchor",n.className="cell-anchor",currentCellColor=n.appendChild(document.createElement("div")),currentCellColor.id="cell"+i+"color",currentCellColor.className="cell-color",currentCellColor.style.backgroundColor=s.color,(o=n.appendChild(document.createElement("div"))).id="cell"+i+"positionholder",o.className="cell-position-holder",o.enlargeId="enlarge"+i,(d=n.appendChild(document.createElement("div"))).id="cell"+i+"name",d.className="cell-name",d.textContent="Ereignisfeld"==s.name?"":s.name,currentCellPrice=n.appendChild(document.createElement("div")),currentCellPrice.id="cell"+i+"price",currentCellPrice.className="cell-price",currentCellPrice.textContent=s.pricetext,currentCellHouse=n.appendChild(document.createElement("div")),currentCellHouse.id="cell"+i+"house",currentCellHouse.className="cell-house",currentCellHouse2=n.appendChild(document.createElement("div")),currentCellHouse2.id="cell"+i+"house2",currentCellHouse2.className="cell-house2",e[i].groupNumber&&((r=n.appendChild(document.createElement("div"))).id="cell"+i+"owner",r.className="cell-owner"),document.getElementById("enlarge"+i+"color").style.backgroundColor=s.color,document.getElementById("enlarge"+i+"name").textContent=s.name,document.getElementById("enlarge"+i+"price").textContent=s.pricetext}function showCreditMenu(){$("#board").hide(),$("#control").hide(),$("#credit").show(),$("#kreditaufnehmenbutton").show(),$("#kredittilgenbutton").show(),document.getElementById("credit-leftp-name").textContent=document.getElementById("p"+playerId+"moneyname").innerHTML,document.getElementById("credit-leftp-money").value="0"}function showTradeMenu(){$("#board").hide(),$("#control").hide(),$("#trade").show(),$("#proposetradebutton").show(),$("#canceltradebutton").show(),$("#accepttradebutton").hide(),$("#rejecttradebutton").hide(),socket.emit("updateSquare"),socket.emit("updatePlayer"),setTimeout((()=>{finishTradeMenu()}),200)}function finishTradeMenu(){var e=player[playerId],t=1===playerId?player[2]:player[1];currentInitiator=e,currentRecipient=t,resetTrade(e,t,!0)}function showStats(){socket.emit("showstats")}function rcvPopupReq(e,t,n=!1){n?popup(e,doMortgage,t):popup(e,t)}function doMortgage(){socket.emit("doMortgage",getCheckedProperty())}function preUpdatePosition(e,t,n){for(var o=0;o<12;o++)document.getElementById("cell"+o).style.border="1px solid black";document.getElementById("player"+e+"figure").animate([{opacity:1},{opacity:0}],{duration:1e3}),setTimeout((()=>{updatePosition(e,t,n)}),1e3)}function updatePosition(e,t,n){document.getElementById("player"+e+"figure").remove();const o=document.getElementById("cell"+t+"positionholder");NodeList.prototype.forEach=Array.prototype.forEach;var d=o.childNodes,r=0,a=0;d.forEach((function(e){e.style.left=r+"px",e.style.top=a+"px",120==r?(r=0,a=24):r+=24}));const i=document.getElementById("cell"+n.position+"positionholder");i.innerHTML+="<div id='player"+e+"figure' class='cell-position' title='"+n.name+"' style='background-color: "+n.color+"; animation-name:changeOpacity; animation-duration: 2s'></div>",NodeList.prototype.forEach=Array.prototype.forEach,d=i.childNodes,r=0,a=0,d.forEach((function(e){e.style.left=r+"px",e.style.top=a+"px",120==r?(r=0,a=24):r+=24})),document.getElementById("cell"+n.position).style.border="1px solid "+n.color}function setName(){setPopuptext("<p>Gib deinen Namen ein</p>");document.getElementById("popuptext").innerHTML+='<div><input type="text" id="playername" title="SpielerIn Name" maxlength="16" /> <input type="button" value="OK" id="namebutton"/></div>';document.getElementById("playername").addEventListener("keyup",(function(e){"Enter"===e.key&&(e.preventDefault(),document.getElementById("namebutton").on("click"))})),$("#namebutton").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400);let e=document.getElementById("playername").value;socket.emit("setName",e)})),$("#popupbackground").fadeIn(400,(function(){$("#popupwrap").show()}))}function setZinssatz(){setPopuptext("<p>Zinssatz ändern</p>");document.getElementById("popuptext").innerHTML+='<div><input type="number" id="zinssatzInput" title="Zinssatz" maxlength="3" value="5" size="3"/> % <input type="button" value="Ändern" id="zinsbutton"/> <input type="button" value="Schließen" id="closezinsbutton"/></div>';document.getElementById("zinssatzInput").addEventListener("keyup",(function(e){"Enter"===e.key&&(e.preventDefault(),document.getElementById("zinsbutton").click())})),$("#zinsbutton").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400),socket.emit("zinssatz",parseInt(document.getElementById("zinssatzInput").value))})),$("#closezinsbutton, #popupbackground").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400),$("#icon-bar a.active").removeClass("active"),$("#logicon").addClass("active")})),$("#popupbackground").fadeIn(400,(function(){$("#popupwrap").show()}))}function setPopuptext(e){document.getElementById("popuptext").innerHTML=e,document.getElementById("popup").style.width="300px",document.getElementById("popup").style.top="0px",document.getElementById("popup").style.left="0px"}function popup(e,t,n){setPopuptext(e),n||"string"!=typeof t||(n=t),"function"!=typeof t&&(t=null),"ja/nein"===(n=n?n.toLowerCase():"")?(document.getElementById("popuptext").innerHTML+='<div><input type="button" value="Ja" id="popupyes" /><input type="button" value="Nein" id="popupno" /></div>',$("#popupyes, #popupno").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400)})),$("#popupyes").on("click",t)):"blank"!==n&&($("#popuptext").append("<div><input type='button' value='OK' id='popupclose' /></div>"),$("#popupclose").focus(),$("#popupclose").on("click",(function(){$("#popupwrap").hide(),$("#popupbackground").fadeOut(400)})).on("click",t)),$("#popupbackground").fadeIn(400,(function(){$("#popupwrap").show()}))}function hidedeed(){$("#deed").hide()}function showdeed(e){socket.emit("showdeed",e)}socket.on("buyhouse2",(function(e){allow2houses=e})),document.getElementById("trade-leftp-money").onchange=tradeAltered,document.getElementById("trade-rightp-money").onchange=tradeAltered,document.getElementById("trade-leftp-anleihen").onchange=tradeAltered,document.getElementById("trade-rightp-anleihen").onchange=tradeAltered,document.getElementById("trade-leftp-derivate").onchange=tradeAltered,document.getElementById("trade-rightp-derivate").onchange=tradeAltered,document.getElementById("trade-leftp-property").onchange=tradeAltered,document.getElementById("trade-rightp-property").onchange=tradeAltered,document.getElementById("trade-leftp-assets").onchange=tradeAltered,document.getElementById("trade-rightp-assets").onchange=tradeAltered,socket.on("receiveOffer",(function(e){initiator=e.initiator,recipient=e.recipient,showTradeMenu(),setTimeout((()=>{writeTrade(e)}),200),$("#proposetradebutton").hide(),$("#canceltradebutton").hide(),$("#accepttradebutton").show(),$("#rejecttradebutton").show(),socket.emit("addAlert",recipient.name+" hat einen Handel mit "+initiator.name+" begonnen."),popup("<p>"+recipient.name+" hat dir, "+initiator.name+", einen Tausch angeboten. Du kannst das Angebot annehmen, ablehnen oder verändern.</p>")})),socket.on("updateSquare",(function(e){square=e})),socket.on("updatePlayer",(function(e,t){player=e,meineBank=t})),socket.on("addAlert",(function(e){addAlert(e)})),socket.on("eliminatePlayer",(function(e,t){showEliminatePlayer(e,t)})),socket.on("updateMoney",(function(e,t,n,o,d){updateMoney(e,t,n,o,d)})),socket.on("updateDice",(function(e){playDiceSound(e)})),socket.on("updateOwned",(function(e,t){updateOwned(e,t)})),socket.on("updateOption",(function(e){updateOption(e)})),socket.on("showdeed",(function(e){showdeed2(e)})),socket.on("showstats",(function(e){displayStats(e)})),socket.on("changeButton",(function(e,t,n){changeButton(e,t,n)})),socket.on("focusbutton",(function(e){focusButton(e)})),socket.on("roll",roll),socket.on("setHTML",(function(e,t){setHTML(e,t)})),socket.on("show",(function(e,t){t?$(e).show():$(e).hide()})),window.onload=function(){document.getElementById("statsdrag").onmousedown=function(e){dragObj=document.getElementById("stats"),dragObj.style.position="relative",dragTop=parseInt(dragObj.style.top,10)||0,dragLeft=parseInt(dragObj.style.left,10)||0,window.event?(dragX=window.event.clientX,dragY=window.event.clientY):e&&(dragX=e.clientX,dragY=e.clientY),drag=!0},document.getElementById("graphdrag").onmousedown=function(e){dragObj=document.getElementById("mgraph"),dragObj.style.position="relative",dragTop=parseInt(dragObj.style.top,10)||0,dragLeft=parseInt(dragObj.style.left,10)||0,window.event?(dragX=window.event.clientX,dragY=window.event.clientY):e&&(dragX=e.clientX,dragY=e.clientY),drag=!0},document.getElementById("popupdrag").onmousedown=function(e){dragObj=document.getElementById("popup"),dragObj.style.position="relative",dragTop=parseInt(dragObj.style.top,10)||0,dragLeft=parseInt(dragObj.style.left,10)||0,window.event?(dragX=window.event.clientX,dragY=window.event.clientY):e&&(dragX=e.clientX,dragY=e.clientY),drag=!0},$("#graphclose, #statsclose, #statsbackground").on("click",(function(){$("#statswrap, #graphwrap").hide(),$("#statsbackground").fadeOut(400),$("#icon-bar a.active").removeClass("active"),$("#logicon").addClass("active")})),setName()},socket.on("setupsquares",(function(e){setupSquares(e)})),socket.on("popup",(function(e,t,n=!1){rcvPopupReq(e,t,n)})),socket.on("updatePosition",(function(e,t,n){preUpdatePosition(e,t,n)})),socket.on("displayFigures",(function(e,t){const n=document.getElementById("cell0positionholder");for(var o=1;o<=t;o++)n.innerHTML+="<div id='player"+o+"figure' class='cell-position' title='"+e[o].name+"' style='background-color: "+e[o].color+";'></div>";var d=n.childNodes;left=0,top=0,d.forEach((function(e){e.style.left=left+"px",e.style.top=top+"px",120==left?(left=0,top=24):left+=24}))}));var auctionproperty,currentbidder=1;function finalizeAuction(){socket.emit("finalizeAuction"),$("#popupbackground").hide(),$("#popupwrap").hide()}function rcvAuction(e,t,n,o,d){player=t,auctionproperty=e,highestbidder=o,highestbid=d,currentbidder=playerId;var r=n[e];popup("<div style='font-weight: bold; font-size: 16px; margin-bottom: 10px;'>Auktion <span id='propertyname'></span></div><div>Höchstes Gebot = $<span id='highestbid'></span> (<span id='highestbidder'></span>)</div><div><span id='currentbidder'></span>, du bist an der Reihe.</div<div><input id='bid' title='Gib ein Gebot für "+r.name+" ab.' style='width: 291px;' /></div><div><input type='button' value='Bieten' onclick='auctionBid();' title='Gib dein Gebot ab.' /><input type='button' value='Aussetzen' title='Diese Runde nicht bieten.' onclick='auctionPass();' /><input type='button' value='Auktion verlassen' title='Nicht mehr für "+r.name+" bieten.' onclick='if (confirm(\"Möchtest du wirklich nicht weiter bieten?\")) auctionExit();' /></div>","blank"),document.getElementById("propertyname").innerHTML="<a href='javascript:void(0);' onmouseover='showdeed("+auctionproperty+");' onmouseout='hidedeed();' class='statscellcolor'>"+r.name+"</a>",document.getElementById("highestbid").innerHTML=parseInt(highestbid,10),document.getElementById("highestbidder").innerHTML=0!=highestbidder?player[highestbidder].name:"N/A",document.getElementById("currentbidder").innerHTML=player[currentbidder].name,document.getElementById("bid").onkeydown=function(e){var t=0,n=!1,o=!1;return window.event?(t=window.event.keyCode,n=window.event.ctrlKey,o=window.event.shiftKey):e&&(t=e.keyCode,n=e.ctrlKey,o=e.shiftKey),!!isNaN(t)||(13===t?(game.auctionBid(),!1):!!(8===t||9===t||46===t||t>=35&&t<=40||n)||!o&&(t>=48&&t<=57||t>=96&&t<=105))},document.getElementById("bid").onfocus=function(){this.style.color="black",isNaN(this.value)&&(this.value="")}}function auctionPass(){0===highestbidder&&(highestbidder=currentbidder),socket.emit("newbid",highestbidder,highestbid),$("#popupbackground").hide(),$("#popupwrap").hide()}function auctionBid(e){""===(e=e||parseInt(document.getElementById("bid").value,10))||null===e?(document.getElementById("bid").value="Gebe ein Gebot ab.",document.getElementById("bid").style.color="red"):isNaN(e)?(document.getElementById("bid").value="Das Gebot muss eine Zahl sein.",document.getElementById("bid").style.color="red"):e>player[currentbidder].money?(document.getElementById("bid").value="Du hast nicht genügend Geld um "+e+" zu bieten.",document.getElementById("bid").style.color="red"):e>highestbid?(highestbid=e,document.getElementById("highestbid").innerHTML=parseInt(e,10),highestbidder=currentbidder,document.getElementById("highestbidder").innerHTML=player[highestbidder].name,document.getElementById("bid").focus(),player[currentbidder].human&&auctionPass()):(document.getElementById("bid").value="Dein Gebot muss höher sein als das höchste Gebot. ($"+highestbid+")",document.getElementById("bid").style.color="red")}function auctionExit(){socket.emit("auctionExit",currentbidder),auctionPass()}socket.on("chooseProperty",(function(e,t){for(var n,o=getCheckedProperty(),d=e[playerId],r="",a=-1,i="",c="",l=0;l<12;l++)if((n=t[l]).owner==playerId){if(i="",n.mortgage&&(i="title='Hypothek aufgenommen' style='color: grey;'"),c="",n.house>=1&&n.house<=2)for(var u=1;u<=n.house;u++)c+="<i class=\"fa-solid fa-house\" title='Haus' class='house' ></i>";""===r&&(r+="<p>"+e[playerId].name+", wähle eines der Grundstücke für die Auktion aus, indem du es anklickst. Klicke OK, wenn du fertig bist.</p>",r+="<table>",a=l),r+="<tr class='property-cell-row'><td class='propertycellcheckbox'><input type='checkbox' id='propertycheckbox"+l+"' /></td><td class='propertycellcolor' style='background: "+n.color+";",r+="' onmouseover='showdeed("+l+");' onmouseout='hidedeed();'></td><td class='propertycellname' "+i+">"+n.name+c+"</td></tr>"}""===r?(r=d.name+", du besitzt keine Grundstücke.",$("#option").hide()):r+="</table>",popup(r,(function(){var e=getCheckedProperty();socket.emit("auctionHouse",e)}),"ok"),o>-1&&document.getElementById("propertycheckbox"+o)?document.getElementById("propertycheckbox"+o).checked=!0:a>-1&&(document.getElementById("propertycheckbox"+a).checked=!0),$(".property-cell-row").on("click",(function(){var e=this;$(this).find(".propertycellcheckbox > input").prop("checked",(function(e,t){return!t})),$(".propertycellcheckbox > input").prop("checked",(function(t,n){if(!$.contains(e,this))return!1})),socket.emit("updateOption")}))})),socket.on("auction",(function(e,t,n,o,d){rcvAuction(e,t,n,o,d)}));var xValues=[],geldMengen=[],bankZinsen=[],myChart=new Chart("myChart",{type:"line",data:{labels:xValues,datasets:[{backgroundColor:"rgba(255,0,0,1.0)",borderColor:"rgba(255,0,0,0.1)",data:geldMengen,label:"Geldmenge",yAxisID:"y"},{backgroundColor:"rgba(0,0,255,1.0)",borderColor:"rgba(0,0,255,0.1)",data:bankZinsen,label:"Zinsen",yAxisID:"y1"}]},options:{responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{},stacked:!1,scales:{y:{type:"linear",display:!0,position:"left"},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1}}}}});$(document).ready((function(){$("#icon-bar a").on("click",(function(e){$("#icon-bar a.active").removeClass("active"),$(this).addClass("active"),e.preventDefault()})),$(".max-button").on("click",(function(e){$(this).parent().parent().children(".moneyopt").show(),$(this).parent().children(".min-button").show(),$(this).hide(),e.preventDefault()})),$(".min-button").on("click",(function(e){$(this).parent().parent().children(".moneyopt").hide(),$(this).parent().children(".max-button").show(),$(this).hide(),e.preventDefault()}))})),$('[title!=""]').qtip({suppress:"false",show:{event:"click"}});